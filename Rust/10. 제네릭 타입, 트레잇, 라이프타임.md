# 제네릭 타입, 트레잇, 라이프타임

## 제네릭
> 구체화된 타입이나 다른 속성들에 대하여 추상화된 대리인
- 여러 다른 종류의 구체적인 데이터 타입에 대해 사용할 수 있는 정의를 생성하도록 함
- 제네릭으로 함수, 구조체, 열거형, 그리고 메소드를 정의할 수 있음
- 제네릭 대신 구체적인 파라미터를 명시했을 때에 비교해 전혀 느려지지 않음 (성능 하락 없음)
    * 컴파일 타임에 제네릭을 사용하는 코드에 대해 단형성화(monomorphization) 를 수행하기 때문
    * 단형성화? 제네릭 코드를 실제로 채워질 구체적인 타입으로 된 특정 코드로 바꾸는 과정
    * 제네릭 사용에 있어 런타임 비용 없음


## 트레잇
> 공유 동작 정의
- 어떠한 목적을 달성하기 위해 필요한 동작의 집합을 정의하기 위해 메소드 시그니처들을 함께 묶는 방법
    * 동작 = 우리가 해당 타입 상에서 호출할 수 있는 메소드들로 구성
- `impl [트레잇명] for [구조체명] {}`
- 트레잇 바운드: 제네릭 타입이 특정한 트레잇을 구현하여 이 타입들이 가지고 있을 필요가 있는 동작을 갖고 있도록 제한하는 것
    * 아무 타입이나 제네릭에 들어갈 수 있는 게 아니라, 특정 동작을 하는 타입으로 제한
    * 다른 언어의 인터페이스와 유사


## 라이프타임
> 참조자 유효화 (컴파일러에게 참조자들이 서로에게 어떤 연관이 있는지에 대한 정보를 줌)
- 러스트에서 모든 참조자는 라이프타임을 가짐
- 라이프타임은 일종의 유효 범위 (스코프)
- 러스트는 원본 레퍼런스가 사라질 **가능성**이 있으면 컴파일 에러를 일으킴
    * 당장 함수를 호출하는 코드가 전혀 없더라도, 그 함수의 생김새 만으로도 이 함수가 댕글링 레퍼런스를 야기할 수 있다고 판단하면 러스트는 컴파일 에러를 일으킨다.
    * 이를 막으려면 라이프타임 파라미터를 정의하면 된다.
    * ```rust
      fn longest<'a>(s1: &'a str, s2: &'a str) -> &'a str {
        // 함수 longest 에 'a 라는 라이프타임이 있고,
        // 레퍼런스 인자 s1, s2, 그리고 리턴 레퍼런스는 같은 라이프타임을 가짐
          if s1.len() > s2.len() {
              s1
          } else {
              s2
          }
      }
      ```
- 라이프타임은 레퍼런스의 이동이 아닌, **대여**에 관한 것
    * 댕글링 참조를 막기 위함 (s2를 대여한 s1이 있는데 s2가 무효화되는 경우)
    * 대여되는 쪽이 대여해가는 쪽 **이상**으로 유효해야 함
    * 라이프타임 파라미터는 절대로 **라이프타임을 변경하는 것이 아님**! 파라미터의 라이프타임은 호출 코드의 문맥에서 결정되는 것이지, 함수 안에서 변경 가능한 것이 아님. 라이프타임 파라미터는 컴파일러에게 컴파일을 위한 힌트를 줄 뿐, 프로그램의 런타임 동작에 어떠한 영향도 주지 않음.
    * 라이프타임 파라미터의 역할은 다양한 레퍼런스 파라미터와 리턴 레퍼런스의 라이프타임을 연결해 주는 것
- 생략 규칙
    * 라이프타임을 항상 명시적으로 정의하는 일은 번거로운 일
    * 몇가지 아주 명백한 상황에서는 라이프타임 파라미터를 명시하지 않아도 러스트가 알아서 라이프타임을 추론
    * 명백한 상황을 판단하는 규칙
        1. 레퍼런스 타입의 파라미터는 모두 각자의 독립된 라이프타임을 가진다. 
        2. 파라미터가 단 하나일 경우, 리턴 레퍼런스는 동일한 라이프타임 파라미터를 가진다. 
        3. 다수의 파라미터가 있는데 그 중 하나가 &self 혹은 &mut self 인 경우(즉 메서드인 경우), self 의 라이프타임은 리턴 레퍼런스의 라이프타임이 된다.
    * 위 경우에 해당되지 않으면 라이프타임 파라미터를 명시적으로 정의해주어야 함 & 안 하면 에러남
- 구조체의 경우엔 구조체가 레퍼런스 타입 필드를 가지고 있다면, 무조건 라이프타임 파라미터가 명시되어야 한다.
- 메소드를 정의할 때, 메소드가 속한 구조체의 필드 또는 메소드의 인자와 리턴값이 라이프타임 파라미터가 필요한 경우라면 impl 에도 라이프타임 파라미터가 필요하다.
- 스태틱 라이프타임은 프로그램 전체에 걸쳐 유효하다. `ex. 스트링 리터럴`


## 참고
- [1번](https://parkcheolu.tistory.com/105)
- [2번](https://yongj.in/rust/rust-lifetime/)