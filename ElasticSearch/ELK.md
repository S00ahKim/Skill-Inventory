# ELK Stack
- 구 ELK stack, 현 Elastic Stack
- `E`lasticSearch, `L`ogstash, `K`ibana


## Elasticsearch
1. 루씬 기반 검색 엔진
2. 기능
    1. 모든 데이터를 인덱싱하여 저장
    2. 검색
    3. 집계
    4. 결과를 클라이언트 또는 다른 애플리케이션으로 전달
    5. 대규모 분산 시스템을 구축할 수 있는 다양한 기능 제공
3. 장점
    1. 뛰어난 검색 능력
       * RDB에서 다루기 어려운 Full text 검색
       * 점수 기반의 다양한 정확도 알고리즘
       * 실시간 분석
    2. 다양한 플러그인들을 사용해 손쉽게 기능 확장
    3. 클라우드 서비스 & 하둡 플랫폼 연동 가능
4. 특징
    1. 오픈소스 (루씬 기반, Java)
    2. 실시간 분석 (하둡 - 배치 기반, ES - 지속적 인덱싱 및 아주 빠른 속도로 그에 대한 검색과 집계 지원)
    3. Full text 검색 (역파일 색인 구조, json `문서` 기반, 쿼리와 결과 모두 json -> 가공 필요)
        * 역파일 색인 구조? 효율적인 검색을 위해 미리 텍스트를 인덱스로 만들어두는 방법 [참고](https://blog.lael.be/post/3056) 
    4. RESTful API (by HTTP)
    5. 멀티테넌시 (index-논리 단위, 실제 저장은 서로 다른 곳에 분산 저장, 별도의 커넥션 없이 한번에 검색하고 한번에 결과 받을 수 있음)


## Logstash
1. 데이터 수집 및 로그 파싱 엔진
2. 특징
    1. JRuby
    2. 데이터 처리 과정: `입력`(Inputs)  ➡️  `필터`(Filters)  ➡️  `출력`(Outputs)
       1. 입력: 다양한 데이터 저장소로부터 데이터를 입력
          * 모든 형태, 크기, 소스의 데이터 수집 가능
          * 다수의 소스에서 동시에 이벤트 수집하는 [다양한 입력](https://www.elastic.co/guide/en/logstash/current/input-plugins.html)지원 
       2. 필터: 데이터를 확장, 변경, 필터링 및 삭제 등의 처리를 통해 가공
          * 소스 -> 저장소 이동 중 각 이벤트를 `구문 분석`하고 명명된 필드를 `식별`하여 `구조`를 구축하며, 이를 공통 형식으로 `변환` 통합
          * 데이터의 동적 변환 가능
              - grok을 통해 비정형 데이터에서 구조 도출
              - IP 주소에서 위치 좌표 해독
              - PII 데이터의 익명화, 민감한 정보 필드 완전 제외
              - 데이터 소스나 형태, 스키마의 용이한 처리
       3. 출력: 다양한 데이터 저장소로 데이터를 전송
          * 다양한 경로의 출력 API 지원 (ES, AWS S3, local files, Redis -> Kafka)
    3. 다양한 플러그인으로 파이프라인 구성 가능


## Kibana
1. 분석 및 시각화 플랫폼
2. 기본 메뉴
    1. Discover
        * Elasticsearch에 색인된 소스 데이터들의 검색을 위한 메뉴
        * 검색창으로 쿼리 & 필터링
        * 시계열 기반 로그 -> 히스토그램
    2. Visualize
        * 집계 기능을 통해 조회된 데이터의 통계를 다양한 차트로 표현할 수 있는 패널 제작
        * 영역차트, 바차트, 파이차트, 라인차트 등
        * 여기서 만든 패널을 조합해서 Dashboard 구성 
    3. Dashboard
        * Visualize 메뉴에서 만들어진 시각화 도구들을 조합해서 대시보드 화면 제작, 저장, 불러오기, 공유 가능
        * 검색창으로 쿼리 & 필터링
3. 특징
    1. Elasticsearch를 가장 쉽게 시각화 할 수 있는 도구
    2. 검색, 집계 기능 이용 가능
    3. 다양한 App 지원 (by 플러그인)


## Beats
1. 경량 데이터 수집기 (단일 목적)
2. Logstash의 부피가 커서 리소스 소모가 많아서 특정한 목적으로 수집해서 필터기능 없이 적재하는 시스템을 개발하던 중 외부 오픈소스를 영입하여 만듦
3. Filebeat
    * Web log 또는 machine log 등이 저장되는 `파일 경로를 지정`하기만 하면 Filebeat은 해당 경로에 적재되는 파일을 읽어들임
    * 새로운 내용이 추가될 때 마다 그 내용을 Elasticsearch로 색인

## References
- [Elastic 가이드북](https://esbook.kimjmin.net/)
- [ElasticSearch 공식 사이트](https://www.elastic.co/)