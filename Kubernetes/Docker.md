# 도커

## 용어
- 도커: 가상실행 환경을 제공하는 오픈소스 플랫폼
- 도커 데몬: 컨테이너를 실행하는 환경 `CDP`
- 도커파일: 이미지를 생성하기 위한 정의서
- 이미지: 사용자가 실행할 코드가 들어있는 바이너리, 생성 후 수정 불가 `CD`
- 컨테이너: 도커가 제공하는 가상실행 환경, 이미지가 메모리에 올라가 실제 수행되는 프로세스, 종료 시 데이터 휘발
- 원격 레지스트리: 도커 이미지를 저장할 수 있는 원격 저장소 (ex. 도커허브)

## 특징
- 장점
    * 빠른 인프라 구축
    * 빠른 서비스 배포
    * 프로세스 실행 표준화
    * 프로세스 실행 환경 동일화 (이식성)
    * 가벼움 (여러 컨테이너는 개별 userspace를 가지면서 서로 커널 공유하여 실행시 리소스 및 시간이 적게 듬)
    * 강한 보안 (고립된 컨테이너 환경)
- VM과 차이
    * VM = [하드웨어 레벨] 서버 + **하이퍼바이저** + 독립적인 가상 OS & APP
    * 도커 = [OS 레벨] 서버 + 도커 데몬 & 컨테이너

## 사용법
- 도커 설치 `brew install docker`
- 컨테이너 실행 `docker run <이미지>:<태그> [<인자>]`
    * 존재하지 않는 이미지일 경우, 원격 저장소에서 이미지를 가져온다.
    * 도커 이미지 형식: `<레지스트리_이름>/<이미지_이름>:<태그>`
    * 기본 태그: `latest`
- 컨테이너 백그라운드 실행 `docker run -d <이미지>`
    * 백그라운드 실행 시 컨테이너 ID를 출력함
- 컨테이너 조회 `docker ps`
- 컨테이너 중단된 것까지 조회 `docker ps -a`
- 컨테이너 상세 정보 조회 `docker inspect <컨테이너_아이디>`
- 컨테이너 로그 조회 `docker logs <컨테이너_아이디>`
- 컨테이너 로그 지속적 조회 `docker logs -f <컨테이너_아이디>`
    * `-f` = follows ouput
    * `ctrl C` = 로그 조회 종료
- 컨테이너 명령어 전달 `docker exec <컨테이너_아이디> <명령어>`
    * 실행된 컨테이너에 패키지 설치나 설정 수정이 필요한 경우
    * 단, 컨테이너는 휘발성이므로 종료되면 변경사항이 없어짐
- 컨테이너-호스트 간 파일 복사 `docker cp <호스트_경로> <컨테이너_아이디>:<컨테이너_경로>`
- 컨테이너 중단 `docker stop <컨테이너_아이디>`
- 중단된 컨테이너 재개 `docker start <컨테이너_아이디>`
- 컨테이너 완전 삭제 `docker rm <컨테이너_아이디>`
    * 더이상 재개 불가
- 컨테이너 접속하여 쉘 실행 `docker run -it <이미지>:<태그> bash`
    * `-it` = interactive (stdin, stdout) tty (teletypewriter)
- 생성된 컨테이너에 접속하여 쉘 실행 `docker exec -it <컨테이너_아이디> bash`
- 로컬에 저장된 이미지 확인 `docker images`
- 도커허브 로그인 `docker login`
- 도커허브에 이미지 업로드 `docker push <유저_이름>/<이미지_이름>`
- 도커허브에서 이미지 다운로드 `docker pull <이미지_이름>`
- 로컬에서 이미지 삭제 `docker rmi <이미지_이름>`
- 도커파일 작성
    * `Dockerfile`
    * ```t
      FROM ubuntu:18.04 # 기반 이미지

      RUN apt-get update && apt-get install -y curl python-dev # 사용자가 지정한 명령 실행

      WORKDIR /root # 이미지의 작업 폴더
      COPY hello.py . # 로컬 호스트의 파일을 이미지에 복사
      ENV my_ver 1.0 # 이미지의 환경변수 지정

      CMD ["python", "hello.py", "guest"] # 이미지 실행 시 디폴트로 실행되는 명령 지정
      ```
- 도커 빌드 `docker build <도커파일_경로> -t <이미지_이름>:<태그>`
- 컨테이너 실행 시 환경변수 주입 `docker run -e <키>=<값> <레지스트리>/<이미지>:<태그>`