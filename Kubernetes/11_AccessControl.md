# 접근 제어
- 쿠버네티스 접근 제어 과정
    * Authentication (이 유저가 누군지 식별)
    * Authorization (이 유저가 이 행동을 할 수 있는지 권한 식별)
    * Admission Control (이 유저의 이 행동이 적절한지 식별) ex. LimitRange, ResourceQuota


## Authentication 인증
- 쿠버네티스의 인증 방법
    * HTTP 인증
    * X.509 인증 (상호 TLS 인증)
    * OpenID 커넥션 (OAuth 같은 인증 provider 사용)
    * Webhook 인증
    * Proxy 인증
- HTTP 인증
    * 쿠버네티스 마스터에 사용자 인증을 받기 위해 Basic Auth를 사용할 수 있음
    * 사용자의 아이디와 비밀번호를 Base64로 인코딩하여 HTTP 요청 헤더에 포함시켜 서버로 전송
    * 클라이언트가 요청 시 `Authorization: Basic <base64-encoded-credentials>` 헤더를 추가함
    * 쉽게 구현할 수 있으나 비밀번호가 노출될 위험이 있으므로 HTTPS를 사용하여 암호화된 채널을 통해 전송해야 함
- X.509 인증
    * 인증서 기반의 인증 방법으로, 공개 키 인프라(PKI)를 사용하여 클라이언트와 서버를 상호 인증
    * 클라이언트와 서버 모두 X.509 인증서를 사용하여 자신을 식별함
        + 클라이언트는 서버에 연결할 때 자신의 클라이언트 인증서를 제시
        + 서버는 클라이언트의 요청을 처리할 때 클라이언트의 인증서를 검증
    * 순서
        + CSR (Certificate Singing Request, 인증서 서명 요청. 서명을 받기 위해 요청하는 문서.) 파일 생성
        + CA (Certificate Authority, 서명된 인증서를 발급하는 기관) 로부터 인증서 서명
        + 발급된 인증서 및 개인키를 KUBECONFIG 파일에 설정
    * 내부 컴포넌트끼리 서로 인증할 때 많이 사용함


## Authorization 권한허가 (RBAC 역할 기반 접근 제어)
- Role (ClusterRole) 어떤 권한을 소유하고 있는지 정의
    * Role: 네임스페이스 안에서 역할을 정의함
    * ClusterRole: 클러스터 레벨로 역할을 정의함
- Subjects 롤을 부여할 대상을 나타냄. ex. User, Group, ServiceAccount
    * User, Group은 명시적으로 정의된 리소스는 아니고 개념적으로만 존재함 (인증 방식에 따라 특정 필드가 사용자/그룹으로 인식됨)
    * ServiceAccount는 명시적으로 정의된 리소스, 네임스페이스 레벨에서 동작, 프로그램이 쿠버네티스와 통신할 때 사용하는 신원
- RoleBinding (ClusterRoleBinding) 롤과 서브젝트의 연결을 정의함
    * 이를 통해 사용자는 부여받은 특정 권한을 사용할 수 있게 됨


## Network Policy 네트워크 접근 제어
- 쿠버네티스는 파드의 네트워크 접근을 제어하는 방법을 제공함
- 단, 일부 제품에 한정함 (Weave, Calico 등)
- 쿠버네티스 네트워크 기본 정책
    * 기본적으로 네트워크 정책은 하나도 없음
    * 하나도 설정된 게 없으니 모든 트래픽이 열려 있음
    * 만약 하나의 정책이라도 설정되면 설정된 파드에 대해서 해당 정책 외의 트래픽은 모두 막힌다
- NetworkPolicy 라는 리소스로 네트워크 정책을 적용할 수 있음
    * 네임스페이스 레벨
    * 라벨 셀렉터를 이용해서 파드에 정책을 적용함
    * 인바운드, 아웃바운드 트래픽 제어 가능
        + 인바운드 ingress: 특정 서버와의 통신만 허용하도록 하거나, DB에 접근할 수 있는 서버를 지정하는 식으로 설정 가능
        + 아웃바운드 egress: 개발망 네임스페이스 안의 파드는 개발망에만 접근 가능하고 리얼망 네임스페이스에 요청 차단하게 설정 가능
- etc.
    * AWS EC2의 경우 메타데이터를 읽는 IP가 열려있어서 이걸 차단하도록 설정할 수 있다.
    * AND 조건과 OR 조건을 설정할 수 있다 (`-`, `--`)