# CI / CD
- 신속하게 프로덕트에 요구사항을 반영함
- 장애를 최소화하고 높은 안정성 확보
- 문제점을 빠르게 발견하여 신속하게 수정되게 도움
- 소프트웨어 품질이 자연스럽게 향상됨
- 수정 부담을 줄여 여럿이 협력하여 개발하기 쉽게 함

## DevOps
- 개발(develop) + 운영(operation)
- 플로우
    * Plan 개발하려는 소프트웨어를 정의하고 요구사항 정리
    * Coding 개발, 리뷰, 저장소에 반영
    * Building 코드를 실행 가능한 형태로 빌드
    * Testing 실행 파일을 테스트
    * Packaging 배포 가능한 형태로 저장
    * Deploy 출시된 산출물을 실제 환경에 배포
    * Operate 배포 이후 정상 동작하도록 관리
    * Monitor 애플리케이션의 성능과 사용성을 측정 및 관측
- 데브옵스는 이런 플로우를 최대한 자동화하여 생산성, 안정성 도모


## CI (Continuous Integration)
> 반복적인 소스코드 통합, 빌드, 테스팅 자동화
- 코드 머지 시 발생하는 충돌을 줄여주고, 개발 사이클이 처지지 않게 함
- 자주 쓰이는 도구: 젠킨스
    * k8s 환경에서는 다이나믹 워커를 많이 사용 (마스터만 실행, 필요에 따라 새로운 워커 생성)
    * 장점: 쉬운 확장, 효율적 리소스 사용, 클러스터 관리 쉬워짐
    * 단점: 워커 노드 생성시마다 지연 시간 발생, 따로 저장하지 않으면 결과물 사라짐, 디버깅이 어려움
    * 단점 보완을 위해 가상노드를 고정시켜 운영할 수도 있으며, 이 경우 물리서버에 구축하는 것과 동일
- 도커 인 도커
    * 젠킨스가 도커 컨테이너로 구동되고, 그 안에서 도커 이미지를 생성 = 도커 안에 도커
    * 실행 방법
        + 컨테이너 안에 도커 데몬서버 자체가 들어있음
        + 컨테이너 안에서 호스트의 도커 서버를 참조 (CI에서는 이걸로 충분; 호스트 도커 소켓을 컨테이너에 볼륨으로 연결)
- 파이프라인
    1. checkout
    2. build 도커 이미지 빌드 안에서 이뤄지므로, CI 서버에서는 명령어만 입력
    3. test 테스트의 책임은 이미지에 넘기고 CI 서버에서는 사전에 정의된 명령어만 입력
    4. push 생성된 이미지를 레포에 업로드
- 젠킨스 파이프라인
    * 젠킨스에서 CI 과정을 하나의 파이프라인으로 관리하도록 제공하는 기능
    * by Jenkinsfile (언어: Groovy)


## CD (Continuous Delivery)
> 반복적인 소프트웨어 패키징과 배포를 자동화
- 로직 변경 또는 설정 변경을 안전하고 빠르게 배포하게 하며, 문제시 롤백할 수 있게 함
- GitOps 깃 저장소를 단일 진실의 원천으로 사용
    * 단일 진실의 원천: 하나의 진실은 하나의 원천에서 비롯한다
    * SW 배포에서의 단일 진실의 원천: 배포 방법을 다양화하면 문제도 다양하게 발생할 수 있으니 통일한다
    * 장점: 문제 발생시 쉽게 환경 파악 가능, 빠르고 안정적 배포 가능
    * sw 배포를 위해 저장소에 yaml 정의서를 기술하고 git 레포만 수정하면 구현체가 내용을 확인하여 운영 환경에 반영함
- GitOps 원칙
    * 선언형 배포 작업 정의서 yaml
    * git을 이용한 배포 버전 관리 (롤백 용이)
    * 변경 사항 운영 반영 자동화 (배포 책임자는 구현체)
    * 배포 책임자(deploy operator)는 반영 뿐 아니라 이상 탐지 및 자가 치유도 담당
- GitOps 구현체 
    * FluxCD
    * ArgoCD (애플리케이션 개념 사용, 여러 git 레포 관리 가능)


## 로컬 쿠버네티스 개발 툴
- GitOps에서는 아무리 작은 변경을 위한 배포더라도 항상 새로운 git 커밋을 생성해야 함
- 로컬 개발시에는 작은 변경마다 커밋을 만들기 비효율적
- 이때 사용할 수 있는 툴이 skaffold
    * 코드 수정 시 이미지 빌드, 업로드, 파드 교체, 로깅까지 자동으로 수행
    * 개발 스크립트, 빌드에 사용할 도커파일, 배포를 위한 정의서 yaml 필요