# Docker

## 요약
1. 컨테이너 기반의 오픈소스 가상화 플랫폼
2. 클라이언트(docker) - 서버(dockerd) 구조로 동작하며, Dockerfile을 스크립트로 작성해서 서버에 빌드 명령을 보내서 컨테이너 이미지를 만들고, 로컬 디스크와 리모트 레지스트리(Docker Hub 등)에 저장할 수 있다.


## 컨테이너
1. 정의: 소프트웨어를 표준화된 유닛으로 패키징하는 기술 (격리된 공간에서 프로세스가 동작하는 기술)
2. 목적: 개발, shipping, 배포
3. 특징: OS를 포함하여 라이브러리, 애플리케이션을 하나의 "이미지"로 패키징할 수 있음
4. 장점
    * 배포 단위로 이미지를 만들 수 있어서 문제가 발생할 여지가 적고, 롤백이 쉬움
    * 리소스를 효율적으로 사용할 수 있음
    * 작고, 빠르고, 이식성이 좋음
5. 주의할 점
    * 서버를 실행할 때마다 옵션을 정확하게 적어주어야 하며, 컨테이너 간 연관 관계가 있을 경우 순서를 지켜야 한다 => Docker Compose
    * ACL을 적용할 때 IP가 변경될 수 있으므로 고려할 것이 있다
6. 기존의 가상화와의 차이
    * VMware나 VirtualBox 등 가상머신: 호스트 OS위에 게스트 OS 전체를 가상화하여 사용하는 방식 (간단하지만, 무겁고 느리다)
    * KVM(Kernel-based Virtual Machine)이나 Xen: 각각 CPU 가상화 또는 반가상화(Paravirtualization) (전체를 가상화하는 것이 아니라 성능 일부 개선)
    * cgroups(control groups)와 namespace를 이용한 LXC(Linux container) 등 컨테이너: 프로세스 격리 (간단하고 빠름)


## 컨테이너 기술의 주요 3기술
격리된 환경에서 빌드할 수 있도록 하는 것은 1,2
1. 리눅스 네임스페이스
- 프로세스 가상화, 격리시키는 역할
- 프로세스 별로 격리된 OS View 제공 (프로세스가 볼 수 있는 뷰를 네임스페이스별로 지정)

2. cgroup
- 도커 데몬이 떠있는 서버에서 컨테이너가 동작하는 방식
- 어플리케이션(프로세스)에게 하드웨어 리소스(ex. CPU, MEM, Disk, Network, …) 를 그룹으로 묶어서 할당하는 기술
- 정해진 양의 리소스만 사용하도록 제한 가능 
- 리소스 할당 방식은 Priority 기반이 많이 쓰임 (우선 순위 부여)

3. unionfs (유니온 파일 시스템)
- 컨테이너가 사용할 파일 시스템을 격리하기 위해 서로 다른 파일 시스템을 합쳐서 하나의 논리적 파일 시스템으로 컨테이너에 제공
- 물리적으로 디스크를 나누는 것은 비효율적이므로, 논리적으로 구현
- 여러 컨테이너가 공유하는 이미지 레이어와 컨테이너 각각이 소유한 컨테이너 레이어가 따로 있음 -> 이걸 합침 (공유할 수 있는 것은 최대한 공유)


## 이미지
1. 정의: 컨테이너 실행에 필요한 파일과 설정값을 포함한 immutable한 개체
2. 컨테이너와의 관계
    * 이미지를 실행한 상태 = 컨테이너
    * 실행 이후 추가/변경되는 것은 이미지가 아니라 컨테이너에 저장됨. 컨테이너의 상태 변화와 이미지는 무관함.
        + 어떻게? `레이어 저장방식` (이미지 역시 필요한 레이어의 집합체이며, 컨테이너로 만들 때에는 여기에 읽기/쓰기 레이어를 추가해 이 레이어에 변경 사항 저장)
    * 하나의 이미지로 다수의 컨테이너 생성 가능


## References
- [초보를 위한 도커 안내서](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html)
- [Docker (Compose) 활용법 - 개발 환경 구성하기](http://raccoonyy.github.io/docker-usages-for-dev-environment-setup/)