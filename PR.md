# 좋은 PR 만들기

## 문제 상황
- 며칠이 지나도 코드 리뷰가 제대로 달리지 않음
- 배포일에 맞춰 억지로 리뷰를 받아 나중에 미처 발견하지 못한 문제 발생
- 원인은 다양하지만, 리뷰하기 어려운 PR에는 특히 이런 일이 잦음

## 리뷰하기 좋은 PR
### 이슈를 만들 때
- 작업은 대개 `이슈 따기` > `코딩` > `PR` > `리뷰` > `머지` 순서로 흐른다.
- 이슈를 딸 때부터 `테크 스펙`을 작성하면 이후 작업에 도움이 된다.
    * 테크 스펙 작성 => 마일스톤에 맞춰 하위 작업 나열 => PR을 쪼개진 작업 단위로 올림
    * PR 단위가 작아야 리뷰하기 좋다.
- `테크 스펙`? 기술(tech) 설명서(spec)
    * [뱅크샐러드: 테크 스펙](https://blog.banksalad.com/tech/we-work-by-tech-spec/)
    * 기능의 구현 방향을 상세하게 기술하는 글
    * 구성
        + 요약
        + 배경 (왜 이 기능을 만드는지, 무엇을 해결하려 하는지, 이전의 시도 등 히스토리)
        + 목표
        + 목표가 아닌 것 (연관은 되어 있지만 의도적으로 해결하지 않는 부분. 지금 다룰 부분이 아닌 것.)
        + 계획 (기술적, 엔지니어링적 접근, 트레이드 오프, 어떤 것들을 고려하고 있는지 목록화)
        + 이외 고려 사항들 (고려했었으나 하지 않기로 결정된 사항들)
        + 마일스톤 (테스트, 배포일 등을 포함해 최대한 자세하게)

### PR 본문
- 리뷰하는 사람이 코드의 문맥을 빠르게 파악할 수 있도록 충분한 정보를 전달해야 한다.
- PR 내용에 포함되어야 할 정보 목록을 템플릿으로 관리할 수 있다.
- 아직 작업중이라면 제목에 명시한다.
- 추천할 만한 템플릿 구성 요소
    * 왜 이 작업이 있었는가? (관련 이슈/티켓/문서 등)
    * 왜 이 변경이 있었는가?
        + 주요 수정 사항 with 커밋 해시, 이해를 돕기 위한 코멘트 작성 등
        + 모든 변경에는 줄바꿈 하나에도 이유가 있으므로 의문을 가질만 하다면 미리 이유를 적어두기
        + 내가 짠 코드에 대해서는 100% 이해하고 설명할 수 있어야 함
    * 리뷰어가 어떤 부분에 집중하면 좋을까?
    * 작업 관련 스크린샷/동영상 등
    * 머지 전 필요한 것들 (DB 컬럼 추가 필요 등)
    * 테스트 가이드
        + 테스트 방법 (리뷰어가 어떻게 테스트할 수 있는지)
        + 테스트 계획 (머지 전후로 계획해둔 테스트가 있다면 명시)
        + 이미 시행한 테스트 (로컬에서 확인한 케이스, 테스트 코드 통과 여부 등. 필수!)
    * 기타
        + 내가 잘 모르는 부분을 명시 (고민하고 있는 네이밍, 확실하게 숙지하지 못한 컨벤션 등)
        + 희망 리뷰일 (리뷰를 완료 받고 싶은 날짜)
        + PR을 올리기 전 한번 점검해서 기본적인 컨벤션을 잘 지킨 코드여야 한다.

### 커밋
- 하나의 PR 안의 여러 커밋들이 중구난방이면 읽기 어렵다. 커밋 히스토리를 깔끔하게 유지하자.
- 작업에 순서를 정해두고 그 순서를 지키면서 커밋을 올리며, 앞 단계의 작업을 뒷 단계에서 수정하지 않도록 한다.
- 되도록 작은 작업 단위로 커밋을 만들자. (1-2줄의 메시지로 포괄할 수 있는 규모)
- 커밋 메시지에는 작업자의 의도를 담자.
    + `deselectItem 함수 호출 추가` (X) 
    + `scroll 완료 후 결정되는 index로 select 상태를 갱신하기 위해, didSelectItamAt:에서는 deselect 처리` (O)


## cf. 좋은 리뷰
- 하나의 PR에서 너무 많은 의견을 남기면 저자가 당황할 수 있다.
    * 처음에는 정말 중요한 피드백(버그, 장애, 성능, 보안)만 남기라.
    * 고수준 피드백이 수용된 이후 저수준 이슈(설계 개선, 변수명 변경, 주석 추가 등)를 논의하라.
- 너무 모든 것에 제공하지는 않아야겠지만, 적당한 예제 코드를 제공하면 좋다.
- PR 범위가 아닌 부분까지 한번에 지적하지 마라. 수정하지 않은 내용은 언급하지 마라.
- 완전하지 않아도 충분히 좋은 코드가 되도록 하는 것이 리뷰의 목적이다.
    * B급이 아니라 F급(기능적으로 틀렸거나, 너무 복잡해서 정합성에 확신이 없는 상태)일 때에만 승인을 보류한다.
    * 팀 정신을 유지하기 위해 불완전한 해결책을 받아들여라. 모든 설계 결함이 항상 실제로 문제가 되지는 않는다.
- 피드백은 명령이 아니라 요청으로 표현해라
- 대부분의 리뷰어가 잘못된 부분에만 집중하지만, 좋은 변경이 있으면 칭찬하라
- 제안이 있다면 그 제안에 대한 이유를 모두 설명하고, 이유는 단순한 의견이 아니라 원칙에 기반해야 한다.


## 참고자료
- [[LIVE] 지속가능한 SW 개발을 위한 코드리뷰 :: 4월 우아한테크세미나](https://www.youtube.com/watch?v=ssDMIcPBqUE&ab_channel=%EC%9A%B0%EC%95%84%ED%95%9C%ED%85%8C%ED%81%AC)
- [코드 리뷰 in 뱅크샐러드 개발 문화](https://blog.banksalad.com/tech/banksalad-code-review-culture/)
- [공통시스템개발팀 코드 리뷰 문화 개선 이야기](https://techblog.woowahan.com/7152/)
- [효과적인 코드 리뷰를 위해서](https://engineering.linecorp.com/ko/blog/effective-codereview)