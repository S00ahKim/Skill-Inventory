# 클라이언트 식별과 쿠키

## 개별 접촉
- HTTP는 익명, stateless, 요청-응답 기반 통신 프로토콜
- 현대 웹사이트: 개인화된 서비스 제공 니즈 O
    * 사용자 특화 환영 메시지
    * 사용자 맞춤 추천
    * 저장된 사용자 정보 (ex. 주소, 카드 번호 등)
    * 세션 추적 (ex. 장바구니)
- HTTP가 사용자를 식별하는 기술
    * 사용자 식별 정보를 전달하는 HTTP 헤더
    * 클라이언트 IP 주소 추적
    * 사용자 로그인 인증
    * URL에 식별자를 포함시킴
    * 식별 정보를 지속해서 유지하는 강력하고 효율적인 쿠키


## HTTP 헤더
1. `From` (요청): 사용자 이메일 주소
    * 악의적인 서버가 메일을 수집해서 스팸 메일을 발송할 우려가 있어서 많이 쓰이지 않음
    * 로봇, 스파이더는 웹마스터가 항의 메일을 보낼 수 있도록 메일 주소를 기재
2. `User-Agent` (요청): 사용자 브라우저
    * 브라우저 이름, 버전, 운영체제 정보 등
    * 콘텐츠를 최적화하는 데 유용
3. `Referer` (요청): 사용자가 링크를 타고 온 페이지
    * 이것만으로 식별하기는 어려움
    * 사용자의 취향, 사용 행태 파악 용이
4. `Authorization` (요청): 사용자 이름과 비밀번호
5. `Client-ip` (확장-요청): 클라이언트의 IP 주소
6. `X-Forwarded-For` (확장-요청): 클라이언트의 IP 주소
7. `Cookie` (확장-요청): 서버가 생성한 ID 라벨


## 클라이언트 IP 주소
- 보통 HTTP 헤더에 IP 주소가 들어가지는 않음 -> 웹 서버 HTTP 요청을 보내 반대쪽 TCP 커넥션의 IP 주소를 알아낼 수 있음
- 단점
    * IP 주소는 사용자가 아니라 컴퓨터를 가리킨다. 여러 사용자가 같은 컴퓨터를 사용할 수 있다.
    * ISP는 동적으로 IP 주소를 할당한다.
    * 많은 사용자가 NAT 방화벽을 통해 인터넷을 사용한다. NAT 장비들은 클라이언트들의 실제 IP 주소를 하나의 방화벽 IP 주소로 변환한다.
    * 서버가 프록시나 게이트웨이와 연결되어 있는 경우, 서버는 클라이언트의 IP 주소 대신 프록시의 IP 주소를 본다. (프록시 확장 헤더(`Client-ip`, `X-Forwarded-For`)를 사용할 수도 있지만 모든 프록시가 그렇게 하지는 않는다.)


## 사용자 로그인
- 웹 사이트 로그인이 쉽도록 HTTP는 `WWW-Authenticate`, `Authorization` 헤더를 사용해 웹 사이트에 사용자 이름을 전달하는 체계를 가짐
- 한번 로그인하면 이후 요청에는 모두 로그인 정보를 함께 보냄
- 과정
    1. 클라이언트가 요청
    2. 서버는 `401 Login Required` 응답과 `WWW-Authenticate` 헤더를 반환해 로그인 요청
    3. 사용자가 입력한 로그인 정보 토큰 `Authorization` 헤더에 담아 보냄 (ex. `Authorization: Basic am910jRmdW4=`)
    4. 추후 요청에 대해서는 서버가 요청하지 않아도 사용자 이름과 비밀번호를 포함해 전달해 세션이 진행되는 내내 사용자에 대한 식별을 유지함
- 단점
    * 귀찮음
    * 각기 다른 사용자 이름과 비밀번호


## 뚱뚱한 URL
- 웹 서버가 URL 뒤에 상태 정보를 추가한 하이퍼링크를 동적으로 생성
- 과정
    1. 사용자가 처음 방문하면 유일한 ID가 생성됨
    2. URL 처음이나 끝에 ID를 추가함 ex. `http://amazon.com/.../002-1145265-801683`
    3. 서버가 ID를 포함한 요청을 받으면 사용자와 관련된 추가적인 정보(ex. 장바구니, 프로필)를 찾고, 응답을 뚱뚱한 URL로 만듦
- 단점
    * 못생긴 URL: 사용자 혼란
    * 공유할 수 없는 URL: 타인과 공유할 수 없음 & 공유한다면 의도치 않은 개인 정보 누출
    * 캐시 불가: URL이 계속 달라지기 때문
    * 서버 부하 가중: 서버가 뚱뚱한 URL에 해당하는 페이지를 다시 그려야 함
    * 이탈: 사용자가 의도치 않게 뚱뚱한 URL 세션에서 이탈할 수 있음. 그럴 경우 사용자 정보 초기화.
    * 세션 간 지속성 부재: 만들어진 뚱뚱한 URL을 유지하기 위해 따로 조치를 취하지 않으면, 결국 이탈하게 되어 정보 초기화.


## 쿠키